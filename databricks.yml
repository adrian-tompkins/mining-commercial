bundle:
  name: mining_commercial_demo
variables:
  project_name:
    description: AI Demo Generator Project
    default: mining_commercial
  warehouse_name:
    description: Name of the SQL warehouse to use
    default: Shared Unity Catalog Serverless
  warehouse_id:
    lookup:
      warehouse: ${var.warehouse_name}
  environment:
    description: Deployment environment
    default: dev
  workspace_path:
    description: Workspace path where bundle files will be synced
    default: /Users/adrian.tompkins@databricks.com/mining_commercial
workspace:
  file_path: ${var.workspace_path}
sync:
  include:
  - agent_bricks_service.py
  - utils.py
  - generate_data.py
  - transformations.sql
  - dashboard_mega_minerals_supply_chain.lvdash.json
  - deploy_resources.py
  - bricks_conf.json
targets:
  dev:
    default: true
    mode: production
    workspace:
      root_path: ${var.workspace_path}/.bundle/${bundle.name}
resources:
  pipelines:
    mining_commercial_pipeline:
      name: '${var.project_name} - Transformation Pipeline'
      libraries:
        - glob:
            include: ./transformations.sql
      catalog: demo_generator
      channel: CURRENT
      photon: true
      root_path: /Workspace/Users/adrian.tompkins@databricks.com/mining_commercial
      schema: adrian_tompkins_mining_commercial
      serverless: true
  jobs:
    demo_workflow:
      name: '${var.project_name} - Data Generation and Transformation'
      tasks:
      - task_key: generate_data
        spark_python_task:
          python_file: ./generate_data.py
          source: WORKSPACE
        environment_key: default
        max_retries: 1
      - task_key: mining_commercial_pipeline
        pipeline_task:
          pipeline_id: ${resources.pipelines.mining_commercial_pipeline.id}
        depends_on:
        - task_key: generate_data
        max_retries: 1
      # - task_key: deploy_agent_bricks
      #   depends_on:
      #   - task_key: sql_transformations
      #   spark_python_task:
      #     python_file: ./deploy_resources.py
      #     source: WORKSPACE
      #   environment_key: default
      #   max_retries: 1
      environments:
      - environment_key: default
        spec:
          client: '3'
          dependencies:
          - faker>=19.0.0
          - holidays>=0.35
          - databricks-sdk>=0.18.0
  schemas:
    demo_schema:
      name: adrian_tompkins_mining_commercial
      catalog_name: demo_generator
      comment: Schema for mining_commercial demo
  volumes:
    raw_data_volume:
      name: raw_data
      catalog_name: demo_generator
      schema_name: adrian_tompkins_mining_commercial
      volume_type: MANAGED
      comment: Volume for mining_commercial raw data and artifacts
  dashboards:
    mega_minerals_supply_chain:
      display_name: ${var.project_name} - Mega Minerals Integrated Supply Chain
      file_path: ./mega_minerals_supply_chain.lvdash.json
      warehouse_id: ${var.warehouse_id}
